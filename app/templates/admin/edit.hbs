<main id="edit" role="main" class="col-md-10 ml-sm-auto">
  {{#each flashMessages.queue as |flash|}}
    {{flash-message flash=flash class="mt-3 mb-0"}}
  {{/each}}
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <heading class="mr-auto">
      <span class="badge badge-primary mr-1">Click on content to edit</span>
      {{#if (not editTitle)}}
        <h1 class="h3" {{action 'titleEdit'}}>{{model.title}} <i class="material-icons">create</i></h1>
      {{else}}
        <div class="input-group mt-2 mr-auto">
          {{input type="text" class="form-control" value=(mut model.title) aria-label="Post title"}}
        </div>
      {{/if}}
    </heading>
    <div class="saving">
      <button type="button" class="btn btn-success" name="button" {{action 'saveContent'}}>
        Save content
      </button>
      {{#if isSaving}}
        <span><i class="material-icons">autorenew</i> Saving content</span>
      {{/if}}
    </div>
  </div>
  <div class="content">
    <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 border-bottom">
      {{#if (and (not-eq model.category 'sermon') model.category)}}
        <div class="form-group row">
          <label for="category-select" class="col-sm-5 col-form-label">Category:</label>
          <div class="col-sm-7">
            <select id="category-select" class="custom-select" onchange= {{action 'saveCat' value="target.value"}}>
              <option value="need" selected="{{if (eq model.category 'need') true}}">Need</option>
              <option value="news" selected="{{if (eq model.category 'news') true}}">News</option>
              <option value="event" selected="{{if (eq model.category 'event') true}}">Event</option>
            </select>
          </div>
        </div>
      {{/if}}
      {{#if model.status}}
        <div class="form-group row">
          <label for="status-select" class="col-sm-5 col-form-label">Status:</label>
          <div class="col-sm-7">
            <select id="status-select" class="custom-select" onchange= {{action 'saveStatus' value="target.value"}}>
              <option value="draft" selected="{{if (eq model.status 'draft') true}}">Draft</option>
              <option value="published" selected="{{if (eq model.status 'published') true}}">Published</option>
            </select>
          </div>
        </div>
      {{/if}}
      {{#if model.date}}
        <div>
          Publish date:
          {{ember-flatpickr
            date=model.date
            dateFormat='d M y'
            onChange=(action 'saveDate')
          }}
        </div>
      {{/if}}
      {{#if model.expires}}
        <div>
          Expiry date:
          {{ember-flatpickr
            date=model.expires
            dateFormat='d M y'
            onChange=(action 'saveExpires')
          }}
        </div>
      {{/if}}
    </div>
    <div class="mt-4 pb-2 border-bottom">
      {{medium-content-editable value=model.text onFinishedTyping=(action "saveContent")}}
    </div>
    {{#if model.speaker}}
      <div class="form-group">
        <label class="col-sm-2 control-label h3">Upload audio</label>
        <div class="col-sm-10">
          {{#if model.link}}
            <p><strong>Upload URL:</strong> {{model.link}}</p>
            <video controls preload="auto" name="{{model.title}}" poster="/assets/img/audio.png" class="w-25">
              <source src="{{model.link}}" type="audio/mp3">
              <p class="body">Your browser doesn't support video/media playback.</p>
              <p><a href="{{model.link}}" download>Download {{media.title}}</a></p>
            </video>
            {{else}}
            <p>No audio file loaded</p>
          {{/if}}
          <br>
          {{#if uploadProgress}}
            <div class="progress">
              <div class="progress-bar" role="progressbar" style={{uploadProgress}} aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
            </div>
          {{/if}}
          <br>
          {{x-file-input class="btn btn-primary mb-0 pb-0" xmultiple=false name="files" action=(action "didSelectAudio") accept="audio/* video/*" alt="Upload audio"}}
        </div>
      </div>
    {{/if}}
    {{#if (if (eq model._internalModel.modelName 'notice') true)}}
      <div class="mt-2 mb-4">
        <h4>Notice tags</h4>
        <p><i class="material-icons">help_outline</i> Add the tag <code>slide</code> for this notice to appear in the carousel on the home page.</p>
        {{#tag-input
          tags=model.tags
          addTag=(action 'addTag')
          removeTagAtIndex=(action 'removeTagAtIndex')
          placeholder='Add tags to your notice'
          as |tag|
        }}
          {{tag}}
        {{/tag-input}}
      </div>
    {{/if}}
  </div>
</main>
